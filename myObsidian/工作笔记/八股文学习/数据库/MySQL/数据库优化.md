## sql及索引优化

### 紧急性业务缓慢场景处理

1. show processlist
查看session的状态，当前用户只能查询自己的连接，root用户可以查询所有的连接。主要观察state字段，分析哪些连接是不正常的，可以看到连接正在执行操作是哪些
2. explain ，show index
explan可以分析阻塞的业务涉及的sql执行计划，需要关注的字段有以下：
- type字段，优化的时候至少要保证type是range级别以上，range代表了= ，<， >， <=， >=， in等范围操作，在range级别以下的是index和All，index和All都代表了全表扫描，index是通过索引进行全表扫描，而All是直接全表扫描
- key字段，如果有覆盖索引则会显示实际的索引名称，没有覆盖索引则显示null
这个阶段需要注意索引失效的场景，常见的是联合索引使用注意事项：
- 最左匹配原则
- 全值匹配优于非全值匹配
- 使用范围查询的字段会导致右边的字段索引失效
show index 可以查看索引状态，判断是否有合适的索引

### 周期性业务缓慢场景处理

1. 打开slow log
2. 根据一定的优先级（业务重要程度或者sql执行缓慢程度），进行逐条sql优化
3. 使用explain进行分析
